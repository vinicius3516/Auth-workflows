name: Deploy to Cloud Provider
on:
  workflow_call:
    inputs:
      provider:
        description: 'Cloud provider to deploy to (google or aws)'
        required: true
        type: string
      ambiente:
        description: 'Environment to deploy to (dev, staging, prod)'
        required: true
        type: string
      manifest:
        description: 'Path to the Kubernetes manifest file'
        required: true
        type: string
jobs:
  deploy:
    environment: ${{ inputs.ambiente }}
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4.1.5

      # --------------------
      # Google Cloud
      # --------------------
      - name: Authenticate with Google Cloud
        if: ${{ inputs.provider == 'google'}}
        run: |
          echo "Aqui estamos simulando a autenticação com o Google Cloud no ambiente ${{ inputs.ambiente }}"
          echo "credentials_json: ${{ secrets.credentials_json }}"
          echo "project_id: ${{ secrets.project_id }}"

      - name: Set up Google Cloud SDK
        if: ${{ inputs.provider == 'google'}}
        run: |
          echo "Aqui estamos configurando o Google Cloud SDK para o ambiente ${{ inputs.ambiente }}"
          echo "Project ID: ${{ secrets.project_id }}"
          echo "Region: ${{ secrets.region }}"
          echo "Cluster Name: ${{ secrets.cluster_name }}"
          echo "Manifest Path: ${{ inputs.manifest }}"
          echo "Deploying to Google Cloud..."



      # --------------------
      # AWS EKS
      # --------------------
      - name: Authenticate with AWS
        if: ${{ inputs.provider == 'aws'}}
        run: |
          echo "Aqui estamos simulando a autenticação com o AWS no ambiente ${{ inputs.ambiente }}"
          echo "aws_access_key_id: ${{ secrets.aws_access_key_id }}"
          echo "aws_secret_access_key: ${{ secrets.aws_secret_access_key }}"

      - name: Set up AWS CLI
        if: ${{ inputs.provider == 'aws'}}
        run: |
          echo "Aqui estamos configurando o AWS CLI para o ambiente ${{ inputs.ambiente }}"
          echo "Project ID: ${{ secrets.project_id }}"
          echo "Region: ${{ secrets.region }}"
          echo "Cluster Name: ${{ secrets.cluster_name }}"
          echo "Manifest Path: ${{ inputs.manifest }}"
          echo "Deploying to AWS EKS..."
